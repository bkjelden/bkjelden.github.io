<html>
	<head>
		<title>Hello, world!</title>
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
		<link rel="stylesheet" href="http://rawgit.com/Eonasdan/bootstrap-datetimepicker/master/build/css/bootstrap-datetimepicker.min.css">
		<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
		<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script src="http://rawgit.com/jasondavies/d3-cloud/master/d3.layout.cloud.js"></script>
		<script src="http://momentjs.com/downloads/moment.min.js"></script>
		<script src="http://rawgit.com/Eonasdan/bootstrap-datetimepicker/master/build/js/bootstrap-datetimepicker.min.js"></script>
		<script src="wordcloud.js"></script>
		<script type="text/javascript">
			$(document).ready(function(){
				var statuses = [];
				var numRequests = 0;
				var initialized = false;
				$.getScript('//connect.facebook.net/en_US/all.js', function(){
					FB.init({
						appId: '849378558411785'
					});
					FB.Event.subscribe('auth.authResponseChange', function(response){
						console.log("auth.authResponseChange");
						console.log(response);
						if(!initialized && response.status == "connected"){
							initialized = true;
							$("#login").hide();
							populateStatuses();
						}
					});
				});
				
				$("#login").click(function(){
					FB.login(function(response) {
						console.log("login")
						console.log(response);
					}, {scope: "public_profile,basic_info,user_status,user_friends,read_stream,export_stream"});
				});
				
				var populateStatuses = function(prevTime){
					var query = '';
					if(prevTime === undefined){
						query = 'SELECT post_id, actor_id, created_time, permalink, message, action_links, like_info FROM stream WHERE source_id = me() AND strlen(message) > 0 LIMIT 5000'
					}else{
						query = 'SELECT post_id, actor_id, created_time, permalink, message, action_links, like_info FROM stream WHERE source_id = me() AND created_time < '+prevTime+' AND strlen(message) > 0 LIMIT 5000'
					}
					FB.api({ method: 'fql.query', query: query }, function(resp){
						if(resp && resp.length > 0){
							statuses = statuses.concat(resp);
							numRequests++;
							populateStatuses(resp[resp.length - 1].created_time);
							$("#progress").text("Loaded "+statuses.length+" statuses using "+numRequests+" requests...");
							
						}else{
							$("#progress").text("Loaded "+statuses.length+" statuses using "+numRequests+" requests... DONE!");
							WordCloud.setStatuses(statuses);
						}
						
					});
				};
			});
		</script>
	</head>
	<body>
		<div id="fb-root"></div>
		<div class="container">
			<div class="row">
				<div id="word-cloud-form" class="form-group">
					<div class="col-sm-4">
						<div class="input-group date" id="before-time">
							<span class="input-group-addon">Before:</span>
							<input type="text" class="form-control" />
							<span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
						</div>
					</div>
					<div class="col-sm-4">
						<div class="input-group date" id="after-time">
							<span class="input-group-addon">After:</span>
							<input type="text" class="form-control" />
							<span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
						</div>
					</div>
					<div class="col-sm-3">
						<div class="input-group">
							<span class="input-group-addon">Posted by:</span>
							<select class="form-control">
								<option>Billy Kjelden</option>
								<option>Rachael Kjelden</option>
							</select>
						</div>
					</div>
					<div class="col-sm-1">
						<div class="btn-group">
							<button type="button" class="btn btn-default" id="filter">Filter!</button>
						</div>
					</div>
				</div>
			</div>
			<div id="content-container" style="height: 900px; background-color: blue" class="col-md-12">
						<button id="login" class="btn btn-lg">Login</button>
			</div>
		</div>
	</body>
<html>
