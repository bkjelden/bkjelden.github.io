<html>
	<head>
		<title>Hello, world!</title>
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
		<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
		<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
		<script src="wordcloud.js">
		<script type="text/javascript">
			$(document).ready(function(){
				var statuses = [];
				var numRequests = 0;
				$.getScript('//connect.facebook.net/en_US/all.js', function(){
					FB.init({
						appId: '849378558411785'
					});
					FB.Event.subscribe('auth.authResponseChange', function(response){
						console.log("auth.authResponseChange");
						console.log(response);
						if(response.status == "connected"){
							$("#login").hide();
							populateStatuses();
						}
					});
				});
				
				$("#login").click(function(){
					FB.login(function(response) {
						console.log("login")
						console.log(response);
					}, {scope: "public_profile,basic_info,user_status,user_friends,read_stream,export_stream"});
				});
				
				var populateStatuses = function(prevTime){
					var query = '';
					if(prevTime === undefined){
						query = 'SELECT post_id, actor_id, created_time, permalink, message, action_links, like_info FROM stream WHERE source_id = me() AND strlen(message) > 0 LIMIT 5000'
					}else{
						query = 'SELECT post_id, actor_id, created_time, permalink, message, action_links, like_info FROM stream WHERE source_id = me() AND created_time < '+prevTime+' AND strlen(message) > 0 LIMIT 5000'
					}
					FB.api({ method: 'fql.query', query: query }, function(resp){
						if(resp && resp.length > 0){
							statuses = statuses.concat(resp);
							numRequests++;
							populateStatuses(resp[resp.length - 1].created_time);
							$("#progress").text("Loaded "+statuses.length+" statuses using "+numRequests+" requests...");
							
						}else{
							$("#progress").text("Loaded "+statuses.length+" statuses using "+numRequests+" requests... DONE!");
							//mapData();
							WordCloud.setStatuses(statuses);
						}
						
					});
				};
			});
		</script>
	</head>
	<body>
		<div id="fb-root"></div>
		<div class="container">
			<button id="login">Login</button>
			<div id="progress"></div>
		</div>
	</body>
<html>
